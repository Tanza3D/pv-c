u#!/bin/bash
TMUX_SESSION="pv-c-dev"
PI_USER="tanza"
PI_HOST="192.168.1.211"
SCREEN_SESSION="pv-c"

# kill existing session
tmux has-session -t $TMUX_SESSION 2>/dev/null && tmux kill-session -t $TMUX_SESSION

# create new tmux session
tmux new-session -d -s $TMUX_SESSION

# left pane: run watcher script
tmux send-keys -t $TMUX_SESSION:0 './sync_and_restart.sh' C-m

# right pane: attach to screen session safely
tmux split-window -h -t $TMUX_SESSION:0
tmux send-keys -t $TMUX_SESSION:0.1 "
ssh -t $PI_USER@$PI_HOST '
# wait until screen session exists
while ! screen -ls | grep -q \"$SCREEN_SESSION\"; do sleep 0.5; done
screen -r \"$SCREEN_SESSION\"
'
" C-m

# attach to tmux
tmux attach -t $TMUX_SESSION
